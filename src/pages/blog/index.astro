---
import BaseLayout from '../../layouts/BaseLayout.astro'
import ArticleCard from '../../components/ArticleCard.astro'
import { getArticles } from '../../lib/api'

const siteName = import.meta.env.SITE_NAME || 'Mon Blog'
const siteUrl = import.meta.env.SITE_URL || ''

let articles = []
let error = ''

try {
  articles = await getArticles()
} catch (e) {
  error = e instanceof Error ? e.message : 'Erreur inconnue'
}
---

<BaseLayout
  title={siteName}
  description={`Les derniers articles de ${siteName}`}
  canonicalUrl={`${siteUrl}/blog`}
>
  <div class="mx-auto max-w-4xl px-4 py-10">
    <h1 class="text-3xl font-bold mb-8">Articles</h1>

    {error ? (
      <p class="text-red-500">{error}</p>
    ) : articles.length === 0 ? (
      <p class="text-gray-500">Aucun article publi√© pour le moment.</p>
    ) : (
      <div class="grid gap-6 sm:grid-cols-2">
        {articles.map((article) => (
          <ArticleCard article={article} />
        ))}
      </div>
    )}
  </div>
</BaseLayout>
